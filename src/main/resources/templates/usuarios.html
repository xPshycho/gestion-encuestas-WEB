<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Listado de Usuarios - Sistema Académico</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 h-screen flex flex-col">
<!-- Barra superior -->
<header class="bg-blue-900 text-white p-4 flex items-center justify-between md:justify-start">
  <button id="openSidebar" class="mr-4 md:hidden focus:outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
         viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>
  <h1 class="text-xl font-bold">Sistema Académico</h1>
</header>

<div class="flex flex-1 overflow-hidden">
  <!-- Sidebar -->
  <aside class="hidden md:flex flex-col w-64 bg-blue-900 text-white p-6">
    <nav class="flex-1">
      <ul class="space-y-2">
        <li>
          <a href="/dashboard" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
            <span>🏠</span>
            <span>Dashboard</span>
          </a>
        </li>
        <li th:if="${usuario != null and usuario.rol.name() == 'ADMINISTRADOR'}">
          <a href="/usuarios" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
            <span>📋</span>
            <span>Usuarios</span>
          </a>
        </li>
        <li>
          <a href="/estudiantes" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
            <span>🎓</span>
            <span>Estudiantes</span>
          </a>
        </li>
        <li>
          <a href="/registros" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
            <span>📝</span>
            <span>Registros</span>
          </a>
        </li>
        <li>
          <a href="/logout" onclick="localStorage.removeItem('authUser');" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
            <span>🚪</span>
            <span>Cerrar Sesión</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Contenido Principal -->
  <main class="flex-1 p-6 overflow-auto">
    <div class="mb-6">
      <h2 class="text-3xl font-semibold">Listado de Usuarios</h2>
    </div>

    <!-- Botón para crear usuario -->
    <div class="mb-4">
      <a href="/crear-usuario" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-700 transition">
        Crear Usuario
      </a>
    </div>

    <!-- Tabla de Usuarios -->
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Usuario</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rol</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
        </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200" th:each="usr : ${usuarios}">
        <tr>
          <td class="px-6 py-4 whitespace-nowrap" th:text="${usr.username}"></td>
          <td class="px-6 py-4 whitespace-nowrap" th:text="${usr.nombre}"></td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span th:if="${usr.rol.name() == 'ADMINISTRADOR'}" class="text-green-600 font-semibold">Administrador</span>
            <span th:if="${usr.rol.name() == 'ENCUESTADOR'}" class="text-blue-600 font-semibold">Encuestador</span>
            <span th:if="${usr.rol.name() == 'USUARIO'}" class="text-gray-600">Usuario</span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap flex space-x-2">
            <a th:href="@{/usuarios/editar/{id}(id=${usr.username})}" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-700">
              Editar
            </a>
            <a th:href="@{/usuarios/eliminar/{id}(id=${usr.username})}" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-700"
               onclick="return confirm('¿Estás seguro de que deseas eliminar este usuario?');">
              Eliminar
            </a>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <div class="mt-4 flex justify-between items-center">
      <div>
        <a th:if="${currentPage > 1}"
           th:href="@{/usuarios(page=${currentPage - 1}, pageSize=${pageSize})}"
           class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
          Anterior
        </a>
      </div>
      <div>
        <span>Página <span th:text="${currentPage}"></span> de <span th:text="${totalPages}"></span></span>
      </div>
      <div>
        <a th:if="${currentPage < totalPages}"
           th:href="@{/usuarios(page=${currentPage + 1}, pageSize=${pageSize})}"
           class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
          Siguiente
        </a>
      </div>
    </div>

    <!-- Selector de cantidad de registros por página -->
    <div class="mt-4">
      <form method="get" action="/usuarios">
        <label for="pageSize" class="mr-2 font-medium text-gray-700">Registros por página:</label>
        <select id="pageSize" name="pageSize" class="border-gray-300 rounded">
          <option value="5" th:selected="${pageSize == 5}">5</option>
          <option value="10" th:selected="${pageSize == 10}">10</option>
        </select>
        <input type="hidden" name="page" th:value="${currentPage}" />
        <button type="submit" class="ml-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Cambiar</button>
      </form>
    </div>
  </main>
</div>

<!-- Overlay del menú para pantallas pequeñas -->
<div id="overlayMenu" class="fixed inset-0 bg-blue-900 text-white p-6 transform -translate-x-full transition-transform duration-300 z-50 md:hidden">
  <button id="closeSidebar" class="absolute top-4 right-4 text-white focus:outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
         viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M6 18L18 6M6 6l12 12"/>
    </svg>
  </button>
  <nav class="mt-10">
    <ul class="space-y-4">
      <li>
        <a href="/dashboard" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
          <span>🏠</span>
          <span>Dashboard</span>
        </a>
      </li>
      <li>
        <a href="/usuarios" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
          <span>📋</span>
          <span>Usuarios</span>
        </a>
      </li>
      <li>
        <a href="/estudiantes" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
          <span>🎓</span>
          <span>Estudiantes</span>
        </a>
      </li>
      <li>
        <a href="/registros" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
          <span>📝</span>
          <span>Registros</span>
        </a>
      </li>
      <li>
        <a href="/logout" onclick="localStorage.removeItem('authUser');" class="block p-2 rounded hover:bg-blue-700 transition flex items-center space-x-2">
          <span>🚪</span>
          <span>Cerrar Sesión</span>
        </a>
      </li>
    </ul>
  </nav>
</div>

<script src="/js/dashboard.js"></script>
</body>
</html>
