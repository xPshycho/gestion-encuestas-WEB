<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title th:text="${estudianteEdicion != null} ? 'Editar Estudiante' : 'Crear Estudiante'">Crear Estudiante</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Cargamos localForage para almacenamiento offline -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.9.0/localforage.min.js"></script>
    <!-- Se mantiene la sincronización solo desde el dashboard -->
    <script src="/js/offlineSync.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-500 to-indigo-700 flex flex-col items-center justify-center min-h-screen p-4">
<div id="formulario"
     class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md backdrop-blur-lg transform opacity-0 translate-y-10 transition-all duration-700 ease-out">
    <h2 class="text-3xl font-bold text-center text-gray-800 mb-6"
        th:text="${estudianteEdicion != null} ? 'Editar Estudiante' : 'Crear Estudiante'">Crear Estudiante</h2>
    <form id="estudianteForm" th:action="${estudianteEdicion != null} ? '/estudiantes/editar' : '/estudiantes/crear'"
          method="post" class="space-y-4">
        <!-- Campo oculto para el id en modo edición -->
        <div th:if="${estudianteEdicion != null}">
            <input type="hidden" name="id" th:value="${estudianteEdicion.id}"/>
        </div>
        <div>
            <label class="block text-gray-700 font-semibold mb-1">Nombre:</label>
            <input type="text" name="nombre" required
                   class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
                   th:value="${estudianteEdicion != null} ? ${estudianteEdicion.nombre} : ''">
        </div>
        <div>
            <label class="block text-gray-700 font-semibold mb-1">Sector:</label>
            <input type="text" name="sector" required
                   class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
                   th:value="${estudianteEdicion != null} ? ${estudianteEdicion.sector} : ''">
        </div>
        <div>
            <label class="block text-gray-700 font-semibold mb-1">Nivel Escolar:</label>
            <select id="nivelEscolarSelect" name="nivelEscolar" required
                    class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                <option value="" disabled th:if="${estudianteEdicion == null}" selected>Selecciona un nivel</option>
                <option th:each="nivel : ${nivelesEscolares}" th:value="${nivel}" th:text="${nivel}"
                        th:selected="${estudianteEdicion != null} ? (${estudianteEdicion.nivelEscolar} == nivel) : false"></option>
            </select>
        </div>
        <div>
            <label class="block text-gray-700 font-semibold mb-1">Latitud:</label>
            <input type="text" name="latitud" id="latitud" class="w-full p-3 border rounded-lg shadow-sm bg-gray-100"
                   readonly
                   th:value="${estudianteEdicion != null} ? '0' : ''">
        </div>
        <div>
            <label class="block text-gray-700 font-semibold mb-1">Longitud:</label>
            <input type="text" name="longitud" id="longitud" class="w-full p-3 border rounded-lg shadow-sm bg-gray-100"
                   readonly
                   th:value="${estudianteEdicion != null} ? '0' : ''">
        </div>
        <button type="submit"
                class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg shadow-md hover:bg-blue-700 transition font-semibold">
            Guardar
        </button>
    </form>
    <a href="/dashboard"
       class="mt-4 block text-center bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition font-semibold">
        Regresar al Dashboard
    </a>
</div>
<script src="/js/formulario-estudiante.js"></script>
</body>
</html>
