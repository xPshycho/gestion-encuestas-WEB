<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title th:text="${usuarioEdicion != null} ? 'Editar Usuario' : 'Crear Usuario'">Crear Usuario</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Cargamos localForage para almacenamiento offline -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.9.0/localforage.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-500 to-indigo-700 flex items-center justify-center min-h-screen p-4">
<div id="formulario"
     class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md backdrop-blur-lg transform opacity-0 translate-y-10 transition-all duration-700 ease-out">

    <h2 class="text-3xl font-bold text-center text-gray-800 mb-6"
        th:text="${usuarioEdicion != null} ? 'Editar Usuario' : 'Crear Usuario'">Crear Usuario</h2>

    <form id="userForm" th:action="${usuarioEdicion != null} ? '/usuarios/editar' : '/register'" method="post"
          class="space-y-4">

        <!-- Campo oculto para el username en modo edición -->
        <div th:if="${usuarioEdicion != null}">
            <input type="hidden" name="username" th:value="${usuarioEdicion.username}"/>
        </div>

        <!-- Campo para el nombre completo -->
        <div>
            <label for="nombre" class="block text-gray-700 font-semibold mb-1">Nombre Completo:</label>
            <input type="text" id="nombre" name="nombre" required
                   class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
                   th:value="${usuarioEdicion != null} ? ${usuarioEdicion.nombre} : ''">
        </div>

        <!-- Campo para el nombre de usuario -->
        <div>
            <label for="username" class="block text-gray-700 font-semibold mb-1">Usuario:</label>
            <input type="text" id="username" name="username" required
                   class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
                   th:value="${usuarioEdicion != null} ? ${usuarioEdicion.username} : ''"
                   th:readonly="${usuarioEdicion != null}">
        </div>

        <!-- Campo para la contraseña -->
        <div>
            <label for="password" class="block text-gray-700 font-semibold mb-1">Contraseña:</label>
            <input type="password" id="password" name="password" required
                   class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
                   th:value="${usuarioEdicion != null} ? ${usuarioEdicion.password} : ''">
        </div>

        <!-- Selector de rol -->
        <div>
            <label for="rol" class="block text-gray-700 font-semibold mb-1">Rol:</label>
            <select id="rol" name="rol" required
                    class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
                <option value="usuario"
                        th:selected="${usuarioEdicion == null or (usuarioEdicion != null and usuarioEdicion.rol.name() == 'USUARIO')}">
                    Usuario
                </option>
                <option value="encuestador"
                        th:selected="${usuarioEdicion != null and usuarioEdicion.rol.name() == 'ENCUESTADOR'}">
                    Encuestador
                </option>
                <option value="admin"
                        th:selected="${usuarioEdicion != null and usuarioEdicion.rol.name() == 'ADMINISTRADOR'}">
                    Administrador
                </option>
            </select>
        </div>

        <!-- Botón para guardar usuario -->
        <button type="submit" id="saveUser"
                class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg shadow-md hover:bg-blue-700 transition font-semibold">
            Guardar Usuario
        </button>
    </form>

    <!-- Botón para regresar al Dashboard -->
    <a href="/dashboard"
       class="mt-4 block text-center bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition font-semibold">
        Regresar al Dashboard
    </a>
</div>

<!-- Enlace al script de validación -->
<script src="/js/formulario-usuario.js"></script>

</body>
</html>
